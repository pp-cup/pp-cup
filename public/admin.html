<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ê–¥–º–∏–Ω–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</title>
  <style>

    body { font-family: sans-serif; padding: 20px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; }
    th { background: #eee; }
    button { margin: 4px; }
  </style>
</head>
<body>
  <h1>–ê–¥–º–∏–Ω–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</h1>
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>–ù–∏–∫</th>
        <th>PP (join)</th>
        <th>PP (now)</th>
        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
      </tr>
    </thead>
    <tbody id="participantTable"></tbody>
  </table>

  <button onclick="clearAll()">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</button>

  <script>
    const adminKey = "mySecretKey"; // –ó–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ—é "—Å–µ–∫—Ä–µ—Ç–∫—É"

    async function load() {
      const res = await fetch("/participants");
      const data = await res.json();
      const tbody = document.getElementById("participantTable");
      tbody.innerHTML = "";
      data.forEach((p, i) => {
        tbody.innerHTML += `
          <tr>
            <td>${p.id}</td>
            <td><input value="${p.username}" id="name-${i}" /></td>
            <td><input type="number" value="${p.pp_at_join}" id="join-${i}" /></td>
            <td><input type="number" value="${p.pp_now}" id="now-${i}" /></td>
            <td>
              <button onclick="update(${p.id}, ${i})">üíæ</button>
              <button onclick="remove(${p.id})">üóëÔ∏è</button>
            </td>
          </tr>
        `;
      });
    }

    async function update(id, i) {
      const body = {
        id,
        username: document.getElementById(`name-${i}`).value,
        pp_at_join: parseFloat(document.getElementById(`join-${i}`).value),
        pp_now: parseFloat(document.getElementById(`now-${i}`).value),
        key: adminKey
      };
      await fetch("/admin/update", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body),
      });
      load();
    }

    async function remove(id) {
      await fetch(`/admin/delete?id=${id}&key=${adminKey}`);
      load();
    }

    async function clearAll() {
      if (!confirm("–¢—ã —Ç–æ—á–Ω–æ —Ö–æ—á–µ—à—å —É–¥–∞–ª–∏—Ç—å –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤?")) return;
      await fetch(`/admin/clear?key=${adminKey}`);
      load();
    }

    load();
  </script>
</body>
</html>